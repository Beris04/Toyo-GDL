<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Visita</title>
<style>
body{font-family:Arial;background:#f2f4f8;padding:12px}
.card{background:#fff;padding:18px;border-radius:14px}
input,textarea,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{background:#25D366;color:#fff;border:none;border-radius:8px}
</style>
</head>
<body>

<div class="card">
<h3>Registro de Visita</h3>
<p><b>Vendedor:</b> <span id="vendedor"></span></p>
<p><b>Fecha:</b> <span id="fecha"></span></p>

<input id="cliente" placeholder="Cliente visitado">
<textarea id="comentarios" placeholder="Comentarios"></textarea>

<button id="btn" onclick="guardar()">Guardar visita</button>
</div>

<script>
if(!localStorage.getItem("usuario")){
  location.href="index.html";
}

const vendedor = localStorage.getItem("usuario");
document.getElementById("vendedor").innerText = vendedor;

const hoy = new Date();
const fecha = hoy.toISOString().split("T")[0];
document.getElementById("fecha").innerText = fecha;

function guardar(){
  navigator.geolocation.getCurrentPosition(pos=>{
    const visitas = JSON.parse(localStorage.getItem("visitas") || "[]");

    visitas.push({
      vendedor,
      cliente:cliente.value,
      comentarios:comentarios.value,
      fecha,
      hora:new Date().toLocaleTimeString(),
      lat:pos.coords.latitude,
      lon:pos.coords.longitude
    });

    localStorage.setItem("visitas", JSON.stringify(visitas));

    cliente.disabled = true;
    comentarios.disabled = true;
    btn.disabled = true;
    btn.innerText = "Visita registrada ✔️";
  }, ()=>{
    alert("No se pudo obtener el GPS");
  });
}
</script>
</body>
</html>

